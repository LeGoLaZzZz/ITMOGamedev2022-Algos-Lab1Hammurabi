

# Lab1Hammurabi Манатов Леонид J4122


## Основные классы:
- `City` - состояние города, кол-во пшеницы, акров и прочее
- `HammurabiConfig` - конфиг со статичной инфой, вероятности, проценты и тп
- `IRoundAction` - интерфейс для действия в раунде
  - `CitizenIncome` - Приход новых жителей
  - `CitizenWheatConsumption` - Трата пшеницы на еду
  - `PlaqueAction` - Чума
  - `RatsAction` - Крысы
  - `WheatIncomeAction` - Сбор пшеницы
- `Round` - сущность которая работает со списком `IRoundAction`
- `IGameLogger` - логгер, выдает текстовую фразу на определенные действия, которую можно вывести в консоль. Например `GetCityStatus(City)` принимает город и выдает текстовую строку с описанием статов города
  - `TestGameLogger` - тестовый вывод для разработки
  - `BeautyGameLogger` - красивый текст для игрока
- `Statistic` - в конце каждого раунда передается сюда инфа и в конце игры можно запросить оценку прохождения
- `GameSave` - банальное сохранение в файл объекта города, статистики и номера раунда
- `RoundCityManagement` - работает с вводом игрока и `City` по покупке\продаже земель и прочего

## Суть подхода:

1. `MainLab1Hammurabi.cpp` инициализирует все сущности (с загрузкой сохранения при необходимости).
2. В цикле количества раундов, создает новый `Round` туда передает список `IRoundAction`,
3. вызывает `round.PlayRound(city, config, logger)` 
4. Round проходит по всем `IRoundAction.DoRoundAction(city, config, shared_info,logger)`
   1. Разным действиям или статистике нужна некоторая инфа, которая генерится при других действиях, ей можно обмениваться через `RoundSharedInfo` - процент умерших от голода например кладется туда
   2. Каждые действия меняют состояние города (добавляют\убавляют людей\пшеницу)
   3. По завершению действия отдают в `Round` - `ActionResult` в которой есть сообщение от логгера, `bool is_lose_result_` и `RoundResultEnum`
       `enum RoundResultEnum
         {
         kStarve, - 45% умерли от голода
         kNoCitizen, - кончились жители
         kRoundResultOk, - все норм
         }`
   4. Round проверяет результат, при необходимости дропает цикл. 
   5. По завершению всех действий `Round` возвращает в `MainLab1Hammurabi` `RoundResultEnum`
5. Далее в мейне инфа о рануде отдается в статистику `statistic.EndRoundStat(round, city);`
6. Если `RoundResultEnum` не ок, игра стопается
7. Если доходят до 10 раунда `statistic.GetGameResult(city)` выводится оценка игроку.
8. Весь текст который выводится в консоль берется из `IGameLogger`


## Пример c `BeautyGameLogger`
<details style="background-color: rgba(55,63,111,0.35)">
<summary>Пример c `BeautyGameLogger`</summary>

```
Есть сохранение, желаете его загрузить? y/n:n  
Состояние города теперь таково:
Пшеницы в амбарах 2800;
В городе проживают 100 жителя;
город занимает 1000 акров;

В году 1 твоего высочайшего правления

В этом году один акр стоит 19 бушелей пшеницы;  
Сколько акров земли повелеваешь купить? 0

Состояние города теперь таково:  
Пшеницы в амбарах 2800;  
В городе проживают 100 жителя;  
город занимает 1000 акров;  
Сколько акров земли повелеваешь продать? 200  

Состояние города теперь таково:  
Пшеницы в амбарах 6600;  
В городе проживают 100 жителя;  
город занимает 800 акров;  
Сколько бушелей пшеницы повелеваешь съесть? 2000  
Сколько акров земли повелеваешь засеять? 800  
Мы собрали 4000 бушелей пшеницы с 800 акров земли по 5 с акра;  
После сборов в абмарах у нас стало 8200 бушелей пшеницы;  

Крысы истребили 6% пшеницы в наших амбарах или 492 бушелей;  
После этого у нас осталось 7708 бушелей пшеницы;  

Бушелей пшеницы было потрачено на пропитание 2000;  

1 человек прибыли в наш великий город;  
Теперь в городе 101 жителей;  

Состояние города теперь таково:  
Пшеницы в амбарах 7708;  
В городе проживают 101 жителя;  
город занимает 800 акров;  

В году 2 твоего высочайшего правления  

В этом году один акр стоит 20 бушелей пшеницы;  
Сколько акров земли повелеваешь купить? 0  

Состояние города теперь таково:  
Пшеницы в амбарах 7708;  
В городе проживают 101 жителя;  
город занимает 800 акров;  
Сколько акров земли повелеваешь продать? 0  

Состояние города теперь таково:  
Пшеницы в амбарах 7708;  
В городе проживают 101 жителя;  
город занимает 800 акров;  
Сколько бушелей пшеницы повелеваешь съесть? 0  
Сколько акров земли повелеваешь засеять? 0  
Мы собрали 0 бушелей пшеницы с 0 акров земли по 3 с акра;  
После сборов в абмарах у нас стало 7708 бушелей пшеницы;  

Крысы истребили 3% пшеницы в наших амбарах или 231 бушелей;  
После этого у нас осталось 7477 бушелей пшеницы;  

Бушелей пшеницы было потрачено на пропитание 0;  
101 человек умерли с голоду, это 100% от населения нашего города  

Состояние города теперь таково:  
Пшеницы в амбарах 7477;  
В городе проживают 0 жителя;  
город занимает 800 акров;  

Вы проиграли!  
Слишком много людей погибло от голода!  
```

</details>



## Пример c `TestGameLogger`
<details style="background-color: rgba(55,63,111,0.35)">
<summary>Пример c `TestGameLogger`</summary>

```
Wanna load saved game? y/n:y
_CityStatus_
  Wheat in ambars:7708
  Wheat on food:0
  Wheat on seed:0
  Citizen total:101
  Acre total:800

___Round: 2___

_acre_cost_18
Enter acre count to buy:12030123012031023
Input Result: kTooBigNumber
Enter acre count to buy:-1
Input Result: kNotNumber
Enter acre count to buy:100

_CityStatus_
  Wheat in ambars:5908
  Wheat on food:0
  Wheat on seed:0
  Citizen total:101
  Acre total:900
Enter acre count to sell:100

_CityStatus_
  Wheat in ambars:7708
  Wheat on food:0
  Wheat on seed:0
  Citizen total:101
  Acre total:800
Enter wheat amount to food:2000
Enter wheat amount to seed:0
_WheatIncomeAction_
  Handled_acres:0
  AcreWheatIncome:2
  TotalIncome:0
  TotalCityWheat:5708

_RatsAction_
  RatsPercentage:2
  WheatAte:114
  TotalCityWheat:5594

_CitizenWheatConsumption_
  WheatConsumed:2000
  HugerDeadPercentage:0
  DeadCitizen:1
  CityCitizen:101->100
  TotalCityWheat:5594

_CitizenIncome_
  Income:28
  TotalCityCitizen:128

_PlaqueAction_
  WasPlaque:1
  DeadCount:64

_CityStatus_
  Wheat in ambars:5594
  Wheat on food:0
  Wheat on seed:0
  Citizen total:64
  Acre total:800

___Round: 3___

_acre_cost_20
Enter acre count to buy:0

_CityStatus_
  Wheat in ambars:5594
  Wheat on food:0
  Wheat on seed:0
  Citizen total:64
  Acre total:800
Enter acre count to sell:0

_CityStatus_
  Wheat in ambars:5594
  Wheat on food:0
  Wheat on seed:0
  Citizen total:64
  Acre total:800
Enter wheat amount to food:0
Enter wheat amount to seed:0
_WheatIncomeAction_
  Handled_acres:0
  AcreWheatIncome:3
  TotalIncome:0
  TotalCityWheat:5594

_RatsAction_
  RatsPercentage:1
  WheatAte:55
  TotalCityWheat:5539

_CitizenWheatConsumption_
  WheatConsumed:0
  HugerDeadPercentage:100
  DeadCitizen:64
  CityCitizen:64->0
  TotalCityWheat:5539

_CityStatus_
  Wheat in ambars:5539
  Wheat on food:0
  Wheat on seed:0
  Citizen total:0
  Acre total:800

___GameLose___
 kStarve

```

</details>



<br>
<br>
<br>
<br>
<details>
<summary> Лирика
</summary>
- Хотел разделить логику игры и UI пользователя, чтобы условно можно было легко поменять работу из консоли на некий интерфейс, который в саму игру чисто бы посылал действия игрока. Но что-то по неопытности в плюсах не вышло и уже делал чтобы заработало

### Вопросы по плюсам
Я разработчик c# и мне супер больно сейчас переходить и что-то писать на плюсах.
Но проблема даже не в сложности языка, а в его неудобстве.

1. Один класс - один файл. .h .cpp
  - Да это круто, но тут получается для одного класса два файла. Один заголовки, другой реализация - что кажется ЖУТКО неудобно.
  - Полинфы о классе в одном файле а другая в другом. Это банально неудобно дебажить, не говоря уже о элементарном "посмореть поля класса приходится лезть в другой файл"
  - Я использую Rider. Обычно для c# но и для с++ тоже, и при работе с шарпом есть очень удобный шорткат "перенести класс в отдельный файл" - эта штука автоматом создает файл, переносит туда класс и тянет все зависимости автоматически. При работе с плюсами этого нет и невыносимо больно выносить класс в отдельные РУКАМИ и еще разносить на .h и .cpp тоже руками
  - При этом если я перенесу файлы из директории в другую директорию то везде где были ссылки на эти файлы нужно руками(!!!) прописывать путь заново. При работе с c# все это работает автоматически
  - добавил доп параметр в интерфейсе, и пришлось не просто 5 реализаторов поменять а 10 файлов залесть и поменять, еще почему-то ни одна IDE мне не показывает файлы в которых ошибки и приходится руками их искать. При работе с шарпом те же IDE все автоматом находят и показывают. Кажется проблема в с++



</details>


<details>
<summary>
Конспект тз + рассуждения
</summary>

- раунд
- игрок
- ресурсы
  - население
    - прирост(на каждый раунд)
  - акры земли
    - стоимость(на каждый раунд)
    - инком пшеницы(на каждый раунд)
  - бушели пшеницы
    - как еда
    - как посев
    - как валюту
- советник
- город
- крысы (едят пшеницу каждый раунд)
- чума - вероятность сократить насленеие
- условия победы N раундов
- условия поражения 
  - 0 население
  - % смертей от голода



### Действия
- Покупать акры (Пшеница валюта)
- Продавать акры (Пшеница валюта)
- Пшеница на семена - посев
- Пшеница на еду



### Последовательность в раунде
1. Инком пшеницы
2. Крысы
3. Трата на еду + смерть от голода
4. Проверка на голод - условие поражение
5. Инком жителей
6. Чума


### Сущности
- City
  - CitizenAmount
  - WheatAmount
  - AcreAmount

- Config
  - int CitizenWheatConsumption
  - int CitizenAcreHandleCount
  - int CitizenSeedWheatCost

- Round
  - int Number
  - RoundActions
    - AcreWheatIncome
      - int AcreWheatIncome
    - Rats
      - int RatsAtePercentage
    - CitizenWheatConsumption
    - LoseCondition Starve
    - Citizen Income
    - Plaque
      - bool WasPlaque
    - int AcrePrice
  - HungerDeathCount

- Statistics
  - Среднеегодовая смертность
  - Кол-во акров на жителя
  - результат-оценка

</details>




